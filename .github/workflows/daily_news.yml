name: Daily Personalized News

on:
  schedule:
    # æ¯æ—¥ 9:00 JST (0:00 UTC)
    - cron: "0 0 * * *"
  workflow_dispatch:
    inputs:
      force_run:
        description: "å·®åˆ†ãŒãªãã¦ã‚‚å®Ÿè¡Œã™ã‚‹"
        required: false
        default: "false"
        type: boolean

permissions:
  contents: write
  issues: write
  id-token: write

jobs:
  collect-news:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Ensure cache directory exists
        run: mkdir -p .cache

      - name: Generate Daily News
        uses: anthropics/claude-code-action@v1
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: "--allowed-tools Bash,Read,Write,Edit,WebSearch,Glob,Grep"
          prompt: |
            # Daily Personalized News - å®Ÿè¡ŒæŒ‡ç¤º

            ## Mission
            æ¯æ—¥ã€æŒ‡å®šã•ã‚ŒãŸãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã®æœ€æ–°æƒ…å ±ã‚’åé›†ã—ã€PM Ã— AIæ–‡è„ˆã§ä¾¡å€¤ã®ã‚ã‚‹è¨˜äº‹ã‚’GitHub Issueã«æŠ•ç¨¿ã™ã‚‹ã€‚

            ## è¿½åŠ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
            - ä»Šæ—¥ã®æ—¥ä»˜: ${{ github.event.repository.updated_at }}
            - Force run: ${{ inputs.force_run }}
            - Repository: ${{ github.repository }}

            ## é‡è¦: æƒ…å ±åé›†æ–¹æ³•
            - **WebSearchã‚’ä½¿ç”¨**: å„ãƒ–ãƒ­ã‚°ã®Search Queryã§ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ¤œç´¢
            - **WebFetchã¯ä½¿ç”¨ã—ãªã„**: Botæ¤œçŸ¥ã§403ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ãŸã‚
            - ä¸¦åˆ—ã§WebSearchã‚’å®Ÿè¡Œã—ã¦åŠ¹ç‡åŒ–

            ## å·¡å›å¯¾è±¡ï¼ˆSearch Queryï¼‰
            - `Anthropic Claude news` (ä»Šæœˆ)
            - `OpenAI GPT news` (ä»Šæœˆ)
            - `Linear app product updates` (ä»Šæœˆ)
            - `Lenny's Newsletter product management` (ä»Šæœˆ)
            - `LayerX ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°` (ä»Šæœˆ)

            ## å®Ÿè¡Œæ‰‹é †
            1. `.cache/daily-news-last.json` ã‚’èª­ã¿è¾¼ã‚€ï¼ˆãªã‘ã‚Œã°ç©ºã¨ã—ã¦æ‰±ã†ï¼‰
            2. WebSearchã§å„ãƒ–ãƒ­ã‚°ã®æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’æ¤œç´¢ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
            3. æ–°è¦è¨˜äº‹ã‚’åé›†ãƒ»ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆPM Ã— AIé–¢é€£åº¦ã§ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼‰
            4. æ–°è¦è¨˜äº‹ãŒã‚ã‚‹å ´åˆã®ã¿:
               - GitHub Issueã‚’ä½œæˆ
               - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
               - å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
            5. æ–°è¦è¨˜äº‹ãŒãªã„å ´åˆ:
               - ã€ŒNo new articles foundã€ã¨ãƒ­ã‚°å‡ºåŠ›ã—ã¦çµ‚äº†
               - Issueã¯ä½œæˆã—ãªã„

            ## Issueä½œæˆæ™‚ã®ã‚³ãƒãƒ³ãƒ‰
            ```bash
            gh issue create \
              --title "ğŸ“° Daily News - $(date +%Y-%m-%d)" \
              --label "daily-news,automated" \
              --body "$(cat /tmp/news-summary.md)"
            ```

            ## ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°å¾Œã®ã‚³ãƒŸãƒƒãƒˆ
            ```bash
            git config user.name "github-actions[bot]"
            git config user.email "github-actions[bot]@users.noreply.github.com"
            git add .cache/daily-news-last.json
            git commit -m "chore: update daily news cache [skip ci]"
            git push
            ```

            ## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆIssue Bodyï¼‰
            ```markdown
            ## Daily Tech News - YYYY-MM-DD

            ### Top Picks (ã‚¹ã‚³ã‚¢ä¸Šä½3ä»¶)

            #### 1. [è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«](URL)
            **Source**: ãƒ–ãƒ­ã‚°å

            ğŸ“ **æ¦‚è¦**: 3-5æ–‡ã§è¦ç´„

            ğŸ’¡ **PMã¸ã®ç¤ºå”†**: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¤ãªã’ã‚‹

            ---
            (ä»¥ä¸‹åŒæ§˜)

            ### Other Notable Articles
            | Title | Source | One-liner |
            |-------|--------|-----------|
            | [Title](url) | Linear | ä¸€è¡Œè¦ç´„ |
            ```
